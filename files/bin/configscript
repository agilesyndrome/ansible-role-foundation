#!/bin/bash
set -e
TEMPLATE=${1}
BACKEND=${2:-ssm}

if [ -z "${TEMPLATE}" ]; then
    echo "Usage: ${0} template_name"
    exit 1
fi

if [ ! -f ~/config/${TEMPLATE} ]; then
    echo "~/config/${TEMPLATE} file does not exist"
    exit 1
fi

cat ~/config/${TEMPLATE} | configfile ${BACKEND} | bash >> ~/log/image.log